#    ______                    
#   /_  __/___ ___  __  ___  __
#    / / / __ `__ \/ / / / |/_/
#   / / / / / / / / /_/ />  <  
#  /_/ /_/ /_/ /_/\__,_/_/|_|  
# 
#######################################################################

#######################################################################
#                               Plugins                               #
#######################################################################
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'sainnhe/tmux-fzf'
# set -g @plugin 'catppuccin/tmux#v2.1.3'
set -g @plugin "janoamaral/tokyo-night-tmux"
set -g @plugin 'olimorris/tmux-pomodoro-plus'

#######################################################################
#                        GENERAL CONFIGURATION                        #
#######################################################################

# --- Copy and Paste --- # 
set -g @yank_selection 'clipboard'
set -g @yank_selection_mouse 'clipboard'

set -g mouse on
setw -g mode-keys vi
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -s set-clipboard on

set -g base-index 1
set -g renumber-windows on

# --- Alarts ---#
set -g monitor-bell on

# Customize activity highlighting
set-window-option -g window-status-activity-style bg=red,fg=white

# Add symbols to window names
set-window-option -g window-status-format '#I:#W#{?window_activity_flag,!,}'

# --- Prefix (Ctrl + q) --- #
set-option -g prefix C-q
unbind-key C-q
bind-key C-q send-prefix
# Set the dalay between prefix and command 
set -s escape-time 1 

# --- Navigation vi-mode --- #
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# --- Panel Navigation (vim-tmux-navigator) --- # 
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
is_fzf="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?fzf$'"

bind -n C-h run "($is_vim && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "($is_vim && tmux send-keys C-j) || ($is_fzf && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "($is_vim && tmux send-keys C-k) || ($is_fzf && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "($is_vim && tmux send-keys C-l) || tmux select-pane -R"

# ---  Panels Redimention --- # 
bind < resize-pane -L 10
bind > resize-pane -R 10
bind - resize-pane -D 10
bind + resize-pane -U 10

# --- Split windows --- # 
bind-key v split-window -h -c "#{pane_current_path}"
bind-key h split-window -v -c "#{pane_current_path}"

unbind '"'
unbind %

# --- Focus panel --- # 
bind -n M-z select-layout main-horizontal
bind -n M-Z select-layout even-horizontal

# --- Swap panel --- #
bind K swap-pane -U
bind J swap-pane -D

# --- Swap windows --- #
bind -n S-Down previous-window
bind -n S-Up next-window


bind O display-popup -d "#{pane_current_path}" \
    -x C -y C -w 80% -h 80% \
    -e "POPUP=true" -E "zsh"

## Oficial doc: https://github.com/denisidoro/navi/blob/master/docs/widgets/howto/TMUX.md
# bind-key -N "Open Navi (cheat sheets)" -T prefix C-g split-window \
#  "$SHELL --login -i -c \ 
#  'navi --print | tmux load-buffer -b tmp - ; tmux paste-buffer -p -t {last} -b tmp -d'"
##
bind-key i run-shell "tmux popup -E -w 80% -h 80% \"navi --print | tmux load-buffer -b navi_temp - ; tmux paste-buffer -p -t #{pane_id} -b navi_temp -d\""

#######################################################################
#                         MENU CONFIGURATION                          #
#######################################################################


bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"

# --- unbind defaulth menu --- #
unbind-key -n MouseDown3Pane

# --- Custom Menu --- #
bind-key -n MouseDown3Pane display-menu -t= -x M -y M \
  -T " Menu " \
  "Paste "           p "paste-buffer -p"                                 \
  "Copy Mode"        c "copy-mode"                                       \
  ""\
  "Horizontal split" h "split-window -h"                                 \
  "Vertical split"   v "split-window -v"                                 \
  ""                 \
  "Close Panel"      x "kill-pane"                                       \
  "Rename Window"    r "command-prompt -I \"#W\" \"rename-window '%%'\"" \
  ""                 \
  "New Sesion"       n "new-session"                                     \
  "List Sesiones"    s "choose-tree -s"                                  \
  ""                 \
  "Reload Config"    R "source-file ~/.tmux.conf; display-message 'Config recargada'"

TMUX_FZF_ORDER="session|window|pane|command|keybinding|clipboard"
TMUX_FZF_LAUNCH_KEY="C-f" # Prefix Ctrl-f

# --- Custom Menu key --- #
bind m \
display-menu -T "\tQuick Menu\t" -x C -y C \
    "New Window"       c "new-window"                                      \
    "Horizontal Split" s "split-window"                                    \
    "Vertical Split"   v "split-window -h"                                 \
    "Close Pane"       x "kill-pane"                                       \
    ""               \
    "Close Panel"    x "kill-pane"                                       \
    "Rename Window"  r "command-prompt -I \"#W\" \"rename-window '%%'\"" \

## Define my own theme (?) 
## https://www.youtube.com/watch?v=WwRljAR9N30

# --- Colors and Panel --- # 
## set -g pane-active-border-style "fg=#5ccc96"
## set -g pane-border-style "fg=#686f9a"
## set-option -g status-style bg='#1b1c36',fg='#ecf0c1'
## set-option -g window-status-current-style bg='#686f9a',fg='#ffffff'
## set-option -g message-style bg='#686f9a',fg='#ecf0c1'

# --- catppuccin Theme --- # 

## set -g @catppuccin_flavor 'mocha'
## set -g @catppuccin_window_status_style "slanted"
set -g status-right-length 100
set -g status-left-length 100

## https://github.com/catppuccin/tmux/blob/main/docs/reference/status-line.md

set -g status-left ""
## set -gF status-right "#{E:@catppuccin_status_pomodoro_plus} #{E:@catppuccin_status_date_time}" 
## set -g @catppuccin_window_text "#W"
## set -g @catppuccin_window_current_text "#W"

# --- Tokyonight Theme --- # 
set -g @tokyo-night-tmux_theme "night"
# set -g @tokyo-night-tmux_show_datetime 1
# set -g @tokyo-night-tmux_date_format YMD
# set -g @tokyo-night-tmux_time_format 24H

# --- Reload Config --- #
bind-key r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded."

# --- Init TPM --- #
run '~/.tmux/plugins/tpm/tpm'

# --- Pomodoro Configuration --- # 

## | sed 'y/0123456789/üØ∞üØ±üØ≤üØ≥üØ¥üØµüØ∂üØ∑üØ∏üØπ/' 
set -g @pomodoro_interval_display " [%s/%s]"
set -g @pomodoro_granularity 'on'
set -g status-interval 1                       # Refresh the status line every second

set -g @pomodoro_mins 30                       # The duration of the Pomodoro
set -g @pomodoro_break_mins 5                  # The duration of the break after the Pomodoro completes
set -g @pomodoro_intervals 4                   # The number of intervals before a longer break is started
set -g @pomodoro_long_break_mins 10            # The duration of the long break
set -g @pomodoro_repeat 'off'                  # Automatically repeat the Pomodoros?
set -g @pomodoro_disable_breaks 'off'          # Turn off breaks

set -g @pomodoro_restart 'R'

# The formatted output when the Pomodoro is running
set -g @pomodoro_on "#[fg=#2a2f41,bg=#7aa2f7] Ó´ì " 

# The formatted output when the break is running
set -g @pomodoro_complete "#[fg=#2a2f41,bg=#59c898] ‚úîÔ∏é "

# The formatted output when the Pomodoro/break is paused
set -g @pomodoro_pause "#[fg=#2a2f41,bg=#e0af67] ÔÅå "                    

# The formatted output when waiting to start a break
set -g @pomodoro_prompt_break "#[fg=#2a2f41,bg=#59c898] ‚è≤Ô∏é break?"      

# The formatted output when waiting to start a Pomodoro
set -g @pomodoro_prompt_pomodoro "#[fg=#2a2f41,bg=#7aa2f7] ‚è±Ô∏é start?"   

set -g status-right \
    "#[fg=#A371F7,bg=#2a2f41] ÓÄÇ #($HOME/.tmux/plugins/tmux-pomodoro-plus/scripts/pomodoro.sh) "

#[fg=#5bcf9e,bg=#2a2f41] Ó™∞#[fg=#7aa2f7,bold] %Y-%m-%d "
#[fg=#5bcf9e,bg=#2a2f41] ÔÄó#[fg=#7aa2f7,bold] %H:%M:%S "

